<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NAVI – Resume Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fa;
      color: #1f2933;
      margin: 0;
      padding: 24px;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 24px 28px 28px;
      box-shadow: 0 10px 28px rgba(15, 23, 42, 0.08);
    }
    h1 {
      margin-top: 0;
      color: #044e54;
      font-size: 26px;
    }
    .nova-banner {
      display: none;
      padding: 10px 12px;
      background: #e0f7f9;
      border-radius: 8px;
      margin-bottom: 18px;
      font-size: 14px;
      color: #035c64;
    }
    .nova-banner strong {
      margin-right: 6px;
    }
    .form-row {
      margin-bottom: 16px;
    }
    label {
      display: block;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }
    input[type="text"],
    textarea {
      width: 100%;
      font-size: 14px;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #cbd2d9;
      box-sizing: border-box;
      resize: vertical;
    }
    textarea {
      min-height: 80px;
    }
    .hint {
      font-size: 12px;
      color: #7b8794;
      margin-top: 2px;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
    }
    .btn-primary {
      background: #14b5d0;
      color: #ffffff;
      border: none;
      padding: 9px 16px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-secondary {
      background: #e4f0f5;
      color: #035c64;
      border: none;
      padding: 9px 16px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
    }
    @media (max-width: 640px) {
      .container {
        padding: 18px 16px 22px;
      }
      .btn-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>NAVI – Resume Builder</h1>

    <div id="novaBanner" class="nova-banner">
      <strong>Loaded from NOVA.</strong>
      <span id="novaBannerSummary"></span>
    </div>

    <form id="resumeForm">
      <div class="form-row">
        <label for="resumeTargetRole">Target Role / Headline</label>
        <input type="text" id="resumeTargetRole" name="targetRole" placeholder="e.g., Operations &amp; Process Improvement Lead" />
        <div class="hint">
          We start with the role identified in NOVA. You can adjust this headline if you want to target a specific title.
        </div>
      </div>

      <div class="form-row">
        <label for="resumeSummary">Professional Summary</label>
        <textarea id="resumeSummary" name="summary" placeholder="A short, purpose-driven summary that tells your story to employers."></textarea>
        <div class="hint">
          NAVI uses your NOVA purpose, role summary, outlook, and salary context to help you tell a clear story in this section.
        </div>
      </div>

      <div class="form-row">
        <label for="resumeTraits">Top Strengths / Traits</label>
        <textarea id="resumeTraits" name="traits" placeholder="Your key traits and strengths, separated by commas."></textarea>
        <div class="hint">
          These traits come from your NOVA results and can be woven into your resume summary, bullet points, and interviews.
        </div>
      </div>

      <div class="form-row">
        <label for="resumeSkills">Skills / Keywords</label>
        <textarea id="resumeSkills" name="skills" placeholder="Skills and keywords employers search for."></textarea>
        <div class="hint">
          NAVI can turn traits into skills and keywords you can use in your resume and job search filters.
        </div>
      </div>

      <!-- Additional sections can be added below (Experience, Education, etc.) -->

      <div class="btn-row">
        <button type="button" class="btn-primary" id="saveResumeBtn">Save Draft (Local)</button>
        <button type="button" class="btn-secondary" id="backToLoginBtn">Back to Login</button>
      </div>
    </form>
  </div>

  <script>
    function loadNovaProfileFromStorage() {
      const raw = localStorage.getItem('novaProfile');
      if (!raw) {
        console.log('No novaProfile found in localStorage');
        return null;
      }
      try {
        const profile = JSON.parse(raw);
        console.log('Loaded novaProfile:', profile);
        return profile;
      } catch (err) {
        console.error('Error parsing novaProfile JSON:', err);
        return null;
      }
    }

    function applyNovaProfileToNavi(profile) {
      if (!profile) return;

      const { role = {}, traits = [], categories = [], purpose = {} } = profile;
      const roleTitle = role.title || "";
      const outlook = role.outlook || "";
      const salary = role.salaryRange || "";
      const roleSummary = role.summary || "";

      const targetRoleInput = document.getElementById('resumeTargetRole');
      const summaryTextarea = document.getElementById('resumeSummary');
      const traitsTextarea = document.getElementById('resumeTraits');
      const skillsTextarea = document.getElementById('resumeSkills');

      // 1) Target Role / Headline
      if (targetRoleInput) {
        targetRoleInput.value = roleTitle;
      }

      // 2) Professional Summary
      if (summaryTextarea) {
        const purposeLine1 = purpose.whyYou ? `You are: ${purpose.whyYou}` : '';
        const purposeLine2 = purpose.whyThisRole ? `This role fits you because: ${purpose.whyThisRole}` : '';
        const purposeLine3 = purpose.whyNow ? `Now is the right time because: ${purpose.whyNow}` : '';

        const pieces = [
          roleSummary,
          purposeLine1,
          purposeLine2,
          purposeLine3,
          outlook ? `Job Outlook: ${outlook}` : '',
          salary ? `Typical Salary Range: ${salary}` : ''
        ].filter(Boolean);

        summaryTextarea.value = pieces.join('\n\n');
      }

      // 3) Traits / Strengths
      if (traitsTextarea) {
        traitsTextarea.value = traits.join(', ');
      }

      // 4) Skills keywords – start by mirroring traits
      if (skillsTextarea) {
        const skillKeywords = traits.map(t => t.replace(/\s+/g, ' '));
        skillsTextarea.value = skillKeywords.join(', ');
      }

      // 5) Banner
      const banner = document.getElementById('novaBanner');
      const bannerSummary = document.getElementById('novaBannerSummary');
      if (banner && bannerSummary) {
        const catText = categories && categories.length
          ? `Categories: ${categories.join(' · ')}. `
          : '';
        const traitText = traits && traits.length
          ? `Top traits: ${traits.slice(0, 5).join(', ')}.`
          : '';
        bannerSummary.textContent = `${catText}${traitText}`;
        banner.style.display = 'block';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const profile = loadNovaProfileFromStorage();
      if (profile) {
        applyNovaProfileToNavi(profile);
      }

      // Local save for resume draft
      const saveBtn = document.getElementById('saveResumeBtn');
      if (saveBtn) {
        saveBtn.addEventListener('click', () => {
          const draft = {
            targetRole: document.getElementById('resumeTargetRole').value,
            summary: document.getElementById('resumeSummary').value,
            traits: document.getElementById('resumeTraits').value,
            skills: document.getElementById('resumeSkills').value,
            savedAt: new Date().toISOString()
          };
          try {
            localStorage.setItem('naviResumeDraft', JSON.stringify(draft));
            alert('Your resume draft has been saved on this device.');
          } catch (err) {
            console.warn('Could not save resume draft', err);
            alert('There was a problem saving your draft on this device.');
          }
        });
      }

      const backBtn = document.getElementById('backToLoginBtn');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          window.location.href = 'login.html';
        });
      }
    });
  </script>
</body>
</html>
