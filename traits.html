<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NOVA – Key Traits</title>

  <style>
    :root {
      --nova-bg: #f9fafb;
      --nova-card-bg: #ffffff;
      --nova-teal: #14b8a6;
      --nova-teal-dark: #0f766e;
      --nova-text-main: #111827;
      --nova-text-muted: #6b7280;
      --nova-border: #e5e7eb;
      --nova-radius-lg: 22px;
      --nova-shadow-soft: 0 24px 60px rgba(15,118,110,0.10);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top left,#ecfeff 0,#f9fafb 45%,#f9fafb 100%);
      color: var(--nova-text-main);
    }

    main.traits-page {
      max-width: 1100px;
      margin: 36px auto 48px;
      padding: 0 16px 56px;
    }

    @media (min-width: 768px) {
      main.traits-page {
        margin-top: 48px;
      }
    }

    .traits-header {
      text-align: center;
      margin-bottom: 28px;
    }

    .traits-step {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 600;
      color: var(--nova-teal);
      margin-bottom: 6px;
    }

    .traits-title {
      font-size: clamp(1.9rem, 3vw, 2.4rem);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .traits-subtitle {
      max-width: 720px;
      margin: 0 auto;
      font-size: 0.98rem;
      color: var(--nova-text-muted);
      line-height: 1.5;
    }

    .traits-category-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #ecfeff;
      border: 1px solid rgba(20,184,166,0.4);
      font-size: 0.86rem;
      color: var(--nova-teal-dark);
      font-weight: 500;
    }

    .traits-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 30px;
    }

    @media (min-width: 768px) {
      .traits-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .trait-card {
      background: var(--nova-card-bg);
      border-radius: var(--nova-radius-lg);
      border: 1px solid var(--nova-border);
      box-shadow: var(--nova-shadow-soft);
      padding: 14px 16px 14px;
      cursor: pointer;
      transition: 0.18s ease;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .trait-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 22px 50px rgba(15,118,110,0.16);
    }

    .trait-card.selected {
      border-color: rgba(20,184,166,0.9);
      box-shadow: 0 26px 60px rgba(15,118,110,0.25);
      background: #ecfeff;
    }

    .trait-name-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .trait-name {
      font-size: 1rem;
      font-weight: 700;
    }

    .trait-chip {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(20,184,166,0.35);
      color: var(--nova-teal-dark);
      background: rgba(240,253,250,0.9);
      font-weight: 600;
    }

    .trait-body {
      font-size: 0.86rem;
      color: var(--nova-text-muted);
      line-height: 1.4;
    }

    .traits-actions {
      margin-top: 28px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }

    @media (min-width: 640px) {
      .traits-actions {
        flex-direction: row;
        justify-content: space-between;
      }
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 0.95rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      border: none;
      transition: 0.18s ease;
      gap: 8px;
    }

    .btn-outline {
      background: transparent;
      color: var(--nova-text-main);
      border: 1px solid var(--nova-border);
    }

    .btn-outline:hover {
      background: #ffffff;
      box-shadow: 0 10px 25px rgba(15,23,42,0.08);
      transform: translateY(-1px);
    }

    .btn-primary {
      background: var(--nova-teal);
      color: #ffffff;
      box-shadow: 0 16px 32px rgba(20,184,166,0.45);
    }

    .btn-primary:hover {
      background: var(--nova-teal-dark);
      box-shadow: 0 18px 36px rgba(15,118,110,0.5);
      transform: translateY(-1px);
    }

    .chevron-left,
    .chevron-right {
      font-size: 1.1rem;
      line-height: 0;
    }

    .traits-helper {
      margin-top: 10px;
      font-size: 0.86rem;
      color: var(--nova-text-muted);
      text-align: center;
    }
  </style>
</head>

<body>
  <main class="traits-page">
    <header class="traits-header">
      <div class="traits-step">Step 1 · Key Traits</div>
      <h1 class="traits-title">Which Traits Sound Most Like You?</h1>
      <p class="traits-subtitle">
        Tap the traits that sound most like how you already show up.
        NOVA will use these to highlight roles that fit the way you’re wired.
      </p>
      <div class="traits-category-pill">
        <span>Based on your category:</span>
        <span id="traitsCategoryLabel">Loading…</span>
      </div>
    </header>

    <section id="traitsGrid" class="traits-grid" aria-label="Key traits"></section>

    <p class="traits-helper">
      You can choose up to six traits. Focus on what’s true most of the time, not just on your very best days.
    </p>

    <nav class="traits-actions" aria-label="Traits navigation">
      <a href="categories.html" class="btn btn-outline">
        <span class="chevron-left">‹</span>
        <span>Back to Categories</span>
      </a>

      <button id="continueTraitsBtn" class="btn btn-primary" type="button">
        <span>Continue to Roles</span>
        <span class="chevron-right">›</span>
      </button>
    </nav>
  </main>

  <script src="nova-profile-helper.js"></script>

  <script>
    function makeIdFromText(text, prefix) {
      if (!text) return prefix + '_unknown';
      const slug = text
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '_')
        .replace(/^_+|_+$/g, '');
      return prefix + '_' + slug;
    }

    const TRAITS_BY_CATEGORY = {
      "People & Community": [
        {
          name: "Heart-Centered Encourager",
          tag: "Build others up",
          blurb: "You naturally build others up, offer hope, and help people not give up."
        },
        {
          name: "Compassionate Listener",
          tag: "Hold space",
          blurb: "You make space for people to be heard, understood, and seen."
        },
        {
          name: "Trust-Builder",
          tag: "Safe presence",
          blurb: "People feel safe opening up or partnering with you."
        },
        {
          name: "Group Uplifter",
          tag: "Lift the room",
          blurb: "You help groups stay positive, hopeful, and energized."
        },
        {
          name: "Support Advocate",
          tag: "Stand with people",
          blurb: "You stand up for people who need help, protection, or support."
        },
        {
          name: "Growth Coach",
          tag: "Grow people",
          blurb: "You enjoy helping others grow, learn, or heal."
        },
        {
          name: "Community Connector",
          tag: "Connect people",
          blurb: "You like introducing people and building relationships and networks."
        },
        {
          name: "Conflict Bridge-Builder",
          tag: "Bridge tension",
          blurb: "You look for common ground and help people move through tension."
        }
      ],

      "Business & Leadership": [
        {
          name: "Strategic Thinker",
          tag: "See the big picture",
          blurb: "You see patterns, connections, and long-term implications others might miss."
        },
        {
          name: "Process Optimizer",
          tag: "Make things smoother",
          blurb: "You spot waste and friction and love making processes flow better."
        },
        {
          name: "People-Centered Leader",
          tag: "Lead with care",
          blurb: "You care about people’s wellbeing while still driving results."
        },
        {
          name: "Outcome Driver",
          tag: "Get to results",
          blurb: "You naturally push projects and teams toward clear outcomes."
        },
        {
          name: "Organizational Architect",
          tag: "Design structure",
          blurb: "You enjoy shaping how teams, roles, and workflows fit together."
        }
      ],

      "Technology & Systems": [
        {
          name: "Systems Optimizer",
          tag: "Improve the engine",
          blurb: "You see how tools and processes work together and how to improve them."
        },
        {
          name: "Logic-Driven Thinker",
          tag: "Reason it out",
          blurb: "You’re comfortable following complex logic and technical details."
        },
        {
          name: "Workflow Streamliner",
          tag: "Simplify steps",
          blurb: "You like turning messy steps into smooth workflows."
        },
        {
          name: "Reliability Guardian",
          tag: "Protect uptime",
          blurb: "You care about stability, reliability, and avoiding downtime."
        },
        {
          name: "Data Structure Builder",
          tag: "Organize information",
          blurb: "You enjoy creating structure for data so it can be used and trusted."
        }
      ],

      "Analysis & Research": [
        {
          name: "Insight Miner",
          tag: "Dig for truth",
          blurb: "You dig beneath the surface to understand what’s really going on."
        },
        {
          name: "Pattern Analyst",
          tag: "Spot patterns",
          blurb: "You notice patterns and trends and like making sense of them."
        },
        {
          name: "Trend Watcher",
          tag: "See what’s coming",
          blurb: "You watch how things are changing and anticipate what’s next."
        },
        {
          name: "Evidence Evaluator",
          tag: "Weigh the data",
          blurb: "You like weighing evidence and making grounded recommendations."
        },
        {
          name: "Detail Verifier",
          tag: "Check the fine print",
          blurb: "You’re careful with details, numbers, and assumptions."
        }
      ],

      "Hands-On & Field Work": [
        {
          name: "On-Site Problem Solver",
          tag: "Fix it live",
          blurb: "You like solving problems right where the work is happening."
        },
        {
          name: "Practical Implementer",
          tag: "Make it real",
          blurb: "You prefer getting things done in the real world, not just on paper."
        },
        {
          name: "Field Adaptor",
          tag: "Adapt in motion",
          blurb: "You can adjust on the fly when conditions change."
        },
        {
          name: "Reliable Operator",
          tag: "Steady and solid",
          blurb: "People count on you because you’re consistent and dependable."
        },
        {
          name: "Task Finisher",
          tag: "Close the loop",
          blurb: "You like finishing what you start and seeing things through."
        },
        {
          name: "Condition Observer",
          tag: "Notice changes",
          blurb: "You notice when conditions or environments shift and respond quickly."
        },
        {
          name: "Safety Steward",
          tag: "Protect people",
          blurb: "You’re attentive to risk, safety, and keeping people out of harm’s way."
        }
      ],

      "Creative & Design": [
        {
          name: "Imaginative Creator",
          tag: "Generate ideas",
          blurb: "You naturally imagine new concepts, visuals, or stories."
        },
        {
          name: "Visual Storycrafter",
          tag: "Tell it visually",
          blurb: "You think in images and like turning ideas into visuals."
        },
        {
          name: "Experience Shaper",
          tag: "Design the feel",
          blurb: "You care about how an experience feels from the user’s point of view."
        },
        {
          name: "Brand Stylist",
          tag: "Shape the brand",
          blurb: "You like aligning colors, fonts, and messaging into a clear identity."
        },
        {
          name: "Idea Illustrator",
          tag: "Make it concrete",
          blurb: "You help people see and understand ideas through creative expression."
        }
      ]
    };

    document.addEventListener("DOMContentLoaded", () => {
      const profile = typeof loadNovaProfile === "function"
        ? loadNovaProfile()
        : {
            categoryIds: [],
            traitIds: [],
            roleId: null,
            categories: [],
            traits: [],
            role: {},
            purpose: { whyYou: "", whyThisRole: "", whyNow: "" }
          };

      let categoryName = "Business & Leadership";
      if (profile.categories && profile.categories.length && profile.categories[0].name) {
        categoryName = profile.categories[0].name;
      } else {
        const legacyCat = localStorage.getItem("novaSelectedCategory");
        if (legacyCat) categoryName = legacyCat;
      }

      const traitsForCategory =
        TRAITS_BY_CATEGORY[categoryName] || TRAITS_BY_CATEGORY["Business & Leadership"];

      const traitsCategoryLabel = document.getElementById("traitsCategoryLabel");
      const traitsGrid = document.getElementById("traitsGrid");
      const continueBtn = document.getElementById("continueTraitsBtn");

      traitsCategoryLabel.textContent = categoryName;

      // initial selected set from profile
      const selectedNames = new Set(profile.traits || []);

      function renderTraits() {
        traitsGrid.innerHTML = "";

        traitsForCategory.forEach(trait => {
          const card = document.createElement("article");
          card.className = "trait-card";

          if (selectedNames.has(trait.name)) {
            card.classList.add("selected");
          }

          const nameRow = document.createElement("div");
          nameRow.className = "trait-name-row";

          const nameEl = document.createElement("h2");
          nameEl.className = "trait-name";
          nameEl.textContent = trait.name;

          const chip = document.createElement("span");
          chip.className = "trait-chip";
          chip.textContent = trait.tag;

          nameRow.appendChild(nameEl);
          nameRow.appendChild(chip);

          const bodyEl = document.createElement("p");
          bodyEl.className = "trait-body";
          bodyEl.textContent = trait.blurb;

          card.appendChild(nameRow);
          card.appendChild(bodyEl);

          card.addEventListener("click", () => {
            const isSelected = selectedNames.has(trait.name);

            if (isSelected) {
              selectedNames.delete(trait.name);
              card.classList.remove("selected");
            } else {
              if (selectedNames.size >= 6) {
                alert("You can pick up to six traits. Deselect one to choose a different trait.");
                return;
              }
              selectedNames.add(trait.name);
              card.classList.add("selected");
            }
          });

          traitsGrid.appendChild(card);
        });
      }

      renderTraits();

      continueBtn.addEventListener("click", () => {
        if (selectedNames.size === 0) {
          const proceed = confirm(
            "You haven’t selected any key traits yet. Do you still want to continue?"
          );
          if (!proceed) return;
        }

        const updated = loadNovaProfile();

        const selectedList = traitsForCategory.filter(t =>
          selectedNames.has(t.name)
        );

        const traitIds = selectedList.map(t =>
          makeIdFromText(t.name, "trait")
        );
        const traitNames = selectedList.map(t => t.name);

        updated.traitIds = traitIds;
        updated.traits = traitNames;

        // keep a legacy store of traits (names) if needed
        localStorage.setItem("novaSelectedTraits", JSON.stringify(traitNames));

        // when traits change, clear any previously-selected role so roles re-align
        updated.roleId = null;
        updated.role = {};

        saveNovaProfile(updated);
        window.location.href = "roles.html";
      });
    });
  </script>
</body>
</html>
