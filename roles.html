<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NOVA – Roles That Fit Your Design</title>

  <style>
    :root {
      --nova-bg: #f9fafb;
      --nova-card-bg: #ffffff;
      --nova-teal: #14b8a6;
      --nova-teal-dark: #0f766e;
      --nova-text-main: #111827;
      --nova-text-muted: #6b7280;
      --nova-border: #e5e7eb;
      --nova-radius-lg: 22px;
      --nova-shadow-soft: 0 24px 60px rgba(15,118,110,0.10);
      --badge-blue: #2563eb;
      --badge-green: #16a34a;
      --badge-amber: #d97706;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top left,#ecfeff 0,#f9fafb 45%,#f9fafb 100%);
      color: var(--nova-text-main);
    }

    main.roles-page {
      max-width: 1100px;
      margin: 36px auto 48px;
      padding: 0 16px 56px;
    }

    @media (min-width: 768px) {
      main.roles-page {
        margin-top: 48px;
      }
    }

    .roles-header {
      text-align: center;
      margin-bottom: 28px;
    }

    .roles-step {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 600;
      color: var(--nova-teal);
      margin-bottom: 6px;
    }

    .roles-title {
      font-size: clamp(1.9rem, 3vw, 2.4rem);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .roles-subtitle {
      max-width: 720px;
      margin: 0 auto;
      font-size: 0.98rem;
      color: var(--nova-text-muted);
      line-height: 1.5;
    }

    .roles-category-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #ecfeff;
      border: 1px solid rgba(20,184,166,0.4);
      font-size: 0.86rem;
      color: var(--nova-teal-dark);
      font-weight: 500;
    }

    .roles-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
      margin-top: 30px;
    }

    @media (min-width: 768px) {
      .roles-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .role-card {
      background: var(--nova-card-bg);
      border-radius: var(--nova-radius-lg);
      border: 1px solid var(--nova-border);
      box-shadow: var(--nova-shadow-soft);
      padding: 18px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      cursor: pointer;
      transition: 0.18s ease;
      position: relative;
    }

    .role-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 26px 55px rgba(15,118,110,0.18);
    }

    .role-card.selected {
      border-color: rgba(20,184,166,0.8);
      box-shadow: 0 28px 60px rgba(15,118,110,0.28);
    }

    .role-title {
      font-size: 1.02rem;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .role-salary {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      font-size: 0.78rem;
      font-weight: 600;
      margin-top: 2px;
    }

    .role-outlook {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 600;
      margin-left: 8px;
      color: #ffffff;
    }

    .role-outlook.blue { background: var(--badge-blue); }
    .role-outlook.green { background: var(--badge-green); }
    .role-outlook.amber { background: var(--badge-amber); }

    .role-body {
      font-size: 0.86rem;
      color: var(--nova-text-muted);
      line-height: 1.45;
      margin-top: 8px;
    }

    .role-why-label {
      margin-top: 10px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--nova-text-muted);
      margin-bottom: 4px;
    }

    .role-traits {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .role-trait-pill {
      padding: 4px 9px;
      border-radius: 999px;
      background: #ecfeff;
      border: 1px solid rgba(20,184,166,0.35);
      font-size: 0.78rem;
      color: var(--nova-teal-dark);
      font-weight: 500;
    }

    .role-selected-tag {
      position: absolute;
      top: 12px;
      right: 14px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: rgba(20,184,166,0.1);
      color: var(--nova-teal-dark);
      border: 1px solid rgba(20,184,166,0.4);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      display: none;
    }

    .role-card.selected .role-selected-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .roles-actions {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }

    @media (min-width: 640px) {
      .roles-actions {
        flex-direction: row;
        justify-content: space-between;
      }
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 0.95rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      border: none;
      transition: 0.18s ease;
      gap: 8px;
    }

    .btn-outline {
      background: transparent;
      color: var(--nova-text-main);
      border: 1px solid var(--nova-border);
    }

    .btn-outline:hover {
      background: #ffffff;
      box-shadow: 0 10px 25px rgba(15,23,42,0.08);
      transform: translateY(-1px);
    }

    .btn-primary {
      background: var(--nova-teal);
      color: #ffffff;
      box-shadow: 0 16px 32px rgba(20,184,166,0.45);
    }

    .btn-primary:hover {
      background: var(--nova-teal-dark);
      box-shadow: 0 18px 36px rgba(15,118,110,0.5);
      transform: translateY(-1px);
    }

    .chevron-left,
    .chevron-right {
      font-size: 1.1rem;
      line-height: 0;
    }

    .roles-helper {
      margin-top: 10px;
      font-size: 0.86rem;
      color: var(--nova-text-muted);
      text-align: center;
    }
  </style>
</head>

<body>
  <main class="roles-page">
    <header class="roles-header">
      <div class="roles-step">Step 2 · Roles</div>
      <h1 class="roles-title">Roles That Fit Your Design</h1>
      <p class="roles-subtitle" id="rolesSubtitle">
        Based on the category and traits you selected, here are roles where you’re likely to thrive.
        Look for patterns in salary, outlook, and type of work that resonate with your story.
      </p>
      <div class="roles-category-pill">
        <span>Category:</span>
        <span id="rolesCategoryLabel">Loading…</span>
      </div>
    </header>

    <section id="rolesGrid" class="roles-grid" aria-label="Suggested roles"></section>

    <p class="roles-helper">
      You don’t have to “marry” a single title. These roles point toward a direction:
      the kind of work, environment, and responsibility level where your gifts shine.
    </p>

    <nav class="roles-actions" aria-label="Role navigation">
      <a href="traits.html" class="btn btn-outline">
        <span class="chevron-left">‹</span>
        <span>Back to Traits</span>
      </a>

      <button id="continueRolesBtn" class="btn btn-primary" type="button">
        <span>Continue to Reveal</span>
        <span class="chevron-right">›</span>
      </button>
    </nav>
  </main>

  <!-- shared helpers -->
  <script src="nova-profile-helper.js"></script>

  <script>
    // Helper to create stable IDs like "role_field_service_technician"
    function makeIdFromText(text, prefix) {
      if (!text) return prefix + '_unknown';
      const slug = text
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '_')
        .replace(/^_+|_+$/g, '');
      return prefix + '_' + slug;
    }

    const rolesByCategory = {
      "Business & Leadership": [
        {
          title: "Operations & Process Improvement Lead",
          salary: "$80,000 – $120,000",
          outlook: "FASTER THAN AVERAGE",
          outlookColor: "blue",
          blurb: "You thrive when making complex systems simpler, more efficient, and more humane.",
          traits: ["Strategic Visionary", "Organizational Architect", "Outcome Driver"]
        },
        {
          title: "Strategy & Business Consultant",
          salary: "$90,000 – $140,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You enjoy diagnosing business challenges and guiding leaders toward clear decisions.",
          traits: ["Growth-Oriented Planner", "Change Champion", "Influential Communicator"]
        },
        {
          title: "Program / Project Manager",
          salary: "$75,000 – $115,000",
          outlook: "STEADY DEMAND",
          outlookColor: "blue",
          blurb: "You enjoy coordinating people, timelines, and resources to bring ideas into reality.",
          traits: ["Team Mobilizer", "Organizational Architect", "Decision Confident"]
        },
        {
          title: "Nonprofit / Program Director",
          salary: "$70,000 – $110,000",
          outlook: "STEADY DEMAND",
          outlookColor: "amber",
          blurb: "You like leading mission-driven work that balances impact, budgets, and teams.",
          traits: ["Trust-Builder", "Growth-Oriented Planner", "Outcome Driver"]
        },
        {
          title: "Product Owner / Delivery Lead",
          salary: "$95,000 – $135,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You enjoy translating vision into deliverables and prioritizing what gets built next.",
          traits: ["Strategic Visionary", "Decision Confident", "Team Mobilizer"]
        }
      ],

      "Technology & Systems": [
        {
          title: "Systems Analyst & Designer",
          salary: "$80,000 – $120,000",
          outlook: "STEADY DEMAND",
          outlookColor: "blue",
          blurb: "You like mapping how information and tools flow so work can run smoothly.",
          traits: ["Systems Optimizer", "Data Structure Builder", "Logic-Driven Thinker"]
        },
        {
          title: "Automation / Workflow Engineer",
          salary: "$85,000 – $130,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You enjoy turning manual processes into smart, automated workflows.",
          traits: ["Automation Designer", "Workflow Streamliner", "Reliability Guardian"]
        },
        {
          title: "Data & Reporting Specialist",
          salary: "$75,000 – $115,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You help teams see what’s happening by structuring and visualizing data.",
          traits: ["Data Structure Builder", "Logic-Driven Thinker", "Systems Optimizer"]
        },
        {
          title: "IT Service & Operations Manager",
          salary: "$85,000 – $125,000",
          outlook: "STEADY DEMAND",
          outlookColor: "blue",
          blurb: "You coordinate people and tools to keep critical systems available.",
          traits: ["Reliability Guardian", "Workflow Streamliner", "Technical Troubleshooter"]
        },
        {
          title: "Cyber & Reliability Coordinator",
          salary: "$90,000 – $135,000",
          outlook: "FASTER THAN AVERAGE",
          outlookColor: "blue",
          blurb: "You focus on stability, security, and risk in technology environments.",
          traits: ["Reliability Guardian", "Logic-Driven Thinker", "Systems Optimizer"]
        }
      ],

      "Creative & Design": [
        {
          title: "Visual / Brand Designer",
          salary: "$65,000 – $105,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You shape the look and feel of brands, products, and experiences.",
          traits: ["Aesthetic Curator", "Visual Storycrafter", "Brand Stylist"]
        },
        {
          title: "UX / Experience Designer",
          salary: "$85,000 – $125,000",
          outlook: "FASTER THAN AVERAGE",
          outlookColor: "blue",
          blurb: "You design flows, layouts, and interactions that feel natural to people.",
          traits: ["Experience Shaper", "Concept Explorer", "Imaginative Creator"]
        },
        {
          title: "Content Creator / Storyteller",
          salary: "$55,000 – $90,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You communicate through words, visuals, or media that move people.",
          traits: ["Narrative Designer", "Idea Illustrator", "Imaginative Creator"]
        },
        {
          title: "Multimedia Producer",
          salary: "$60,000 – $95,000",
          outlook: "STEADY DEMAND",
          outlookColor: "amber",
          blurb: "You enjoy planning, shooting, and editing video or audio projects.",
          traits: ["Visual Storycrafter", "Experience Shaper", "Concept Explorer"]
        },
        {
          title: "Creative Director (Associate / Junior)",
          salary: "$90,000 – $135,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You guide creative direction and help align projects to a larger vision.",
          traits: ["Brand Stylist", "Narrative Designer", "Imaginative Creator"]
        }
      ],

      "People & Community": [
        {
          title: "People Development & Training Specialist",
          salary: "$65,000 – $100,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You help people grow through teaching, coaching, and structured learning.",
          traits: ["Growth Coach", "Group Uplifter", "Community Connector"]
        },
        {
          title: "Life / Career Coach",
          salary: "$60,000 – $110,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You walk with individuals as they navigate decisions, transitions, and purpose.",
          traits: ["Heart-Centered Encourager", "Compassionate Listener", "Trust-Builder"]
        },
        {
          title: "Community Outreach Coordinator",
          salary: "$55,000 – $85,000",
          outlook: "STEADY DEMAND",
          outlookColor: "amber",
          blurb: "You organize events, partnerships, and services that reach people where they are.",
          traits: ["Community Connector", "Support Advocate", "Group Uplifter"]
        },
        {
          title: "HR Business Partner",
          salary: "$80,000 – $120,000",
          outlook: "STEADY DEMAND",
          outlookColor: "blue",
          blurb: "You bridge the needs of people and the goals of the organization.",
          traits: ["Trust-Builder", "Growth Coach", "Support Advocate"]
        },
        {
          title: "Student Success / Support Advisor",
          salary: "$55,000 – $80,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You help students or learners stay on track, resourced, and encouraged.",
          traits: ["Compassionate Listener", "Heart-Centered Encourager", "Community Connector"]
        }
      ],

      "Analysis & Research": [
        {
          title: "Research & Insights Analyst",
          salary: "$75,000 – $115,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You dig into data and stories to surface what’s really true.",
          traits: ["Insight Miner", "Pattern Analyst", "Trend Watcher"]
        },
        {
          title: "Policy / Compliance Analyst",
          salary: "$70,000 – $110,000",
          outlook: "STEADY DEMAND",
          outlookColor: "blue",
          blurb: "You make sure decisions and processes line up with standards and rules.",
          traits: ["Evidence Evaluator", "Precision Planner", "Detail Verifier"]
        },
        {
          title: "Market Research Specialist",
          salary: "$70,000 – $105,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You study customers, markets, and trends to guide strategy.",
          traits: ["Trend Watcher", "Insight Miner", "Pattern Analyst"]
        },
        {
          title: "Risk & Controls Analyst",
          salary: "$80,000 – $120,000",
          outlook: "FASTER THAN AVERAGE",
          outlookColor: "blue",
          blurb: "You identify where things could go wrong and how to protect against it.",
          traits: ["Risk Mapper", "Evidence Evaluator", "Precision Planner"]
        },
        {
          title: "Business Intelligence Analyst",
          salary: "$85,000 – $125,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You turn raw data into dashboards and insights leaders can act on.",
          traits: ["Pattern Analyst", "Detail Verifier", "Insight Miner"]
        }
      ],

      "Hands-On & Field Work": [
        {
          title: "Field Service Technician",
          salary: "$60,000 – $90,000",
          outlook: "STEADY DEMAND",
          outlookColor: "blue",
          blurb: "You troubleshoot and resolve issues on-site where work is happening.",
          traits: ["On-Site Problem Solver", "Practical Implementer", "Tools & Tactics Expert"]
        },
        {
          title: "Operations Field Coordinator",
          salary: "$65,000 – $100,000",
          outlook: "STEADY DEMAND",
          outlookColor: "amber",
          blurb: "You coordinate people, equipment, and schedules in the field.",
          traits: ["Field Adaptor", "Reliable Operator", "Condition Observer"]
        },
        {
          title: "Facilities & Maintenance Lead",
          salary: "$60,000 – $95,000",
          outlook: "STEADY DEMAND",
          outlookColor: "blue",
          blurb: "You keep spaces, buildings, or sites functioning day to day.",
          traits: ["Task Finisher", "Practical Implementer", "Condition Observer"]
        },
        {
          title: "Safety & Compliance Specialist",
          salary: "$65,000 – $105,000",
          outlook: "FASTER THAN AVERAGE",
          outlookColor: "blue",
          blurb: "You focus on safety, procedures, and standards in real environments.",
          traits: ["Safety Steward", "Risk Mapper", "Reliable Operator"]
        },
        {
          title: "Logistics & Delivery Supervisor",
          salary: "$65,000 – $100,000",
          outlook: "GROWING",
          outlookColor: "green",
          blurb: "You oversee how people, tools, or materials move where they’re needed.",
          traits: ["Field Adaptor", "Condition Observer", "Task Finisher"]
        }
      ]
    };

    document.addEventListener("DOMContentLoaded", () => {
      const profile = typeof loadNovaProfile === "function"
        ? loadNovaProfile()
        : {
            categoryIds: [],
            traitIds: [],
            roleId: null,
            categories: [],
            traits: [],
            role: {},
            purpose: { whyYou: "", whyThisRole: "", whyNow: "" }
          };

      // Prefer category from profile; fall back to older localStorage key
      let category = "Business & Leadership";
      if (profile.categories && profile.categories.length && profile.categories[0].name) {
        category = profile.categories[0].name;
      } else {
        const storedCat = localStorage.getItem("novaSelectedCategory");
        if (storedCat) category = storedCat;
      }

      const roles = rolesByCategory[category] || rolesByCategory["Business & Leadership"];

      const rolesCategoryLabel = document.getElementById("rolesCategoryLabel");
      const rolesGrid = document.getElementById("rolesGrid");
      const continueBtn = document.getElementById("continueRolesBtn");

      rolesCategoryLabel.textContent = category;

      const previouslySelectedRoleTitle =
        (profile.role && profile.role.title) ||
        localStorage.getItem("novaSelectedRole") ||
        null;

      let selectedRoleTitle = previouslySelectedRoleTitle;
      let selectedRoleObject = (profile.role && profile.role.title) ? profile.role : null;

      function renderRoles() {
        rolesGrid.innerHTML = "";

        roles.forEach(role => {
          const card = document.createElement("article");
          card.className = "role-card";

          if (selectedRoleTitle === role.title) {
            card.classList.add("selected");
          }

          const selectedTag = document.createElement("div");
          selectedTag.className = "role-selected-tag";
          selectedTag.textContent = "SELECTED";

          const titleEl = document.createElement("h2");
          titleEl.className = "role-title";
          titleEl.textContent = role.title;

          const metaRow = document.createElement("div");

          const salaryEl = document.createElement("span");
          salaryEl.className = "role-salary";
          salaryEl.textContent = role.salary;

          const outlookEl = document.createElement("span");
          outlookEl.className = "role-outlook " + (role.outlookColor || "blue");
          outlookEl.textContent = role.outlook;

          metaRow.appendChild(salaryEl);
          metaRow.appendChild(outlookEl);

          const bodyEl = document.createElement("p");
          bodyEl.className = "role-body";
          bodyEl.textContent = role.blurb;

          const whyLabel = document.createElement("div");
          whyLabel.className = "role-why-label";
          whyLabel.textContent = "Why this fits you";

          const traitsWrap = document.createElement("div");
          traitsWrap.className = "role-traits";

          (role.traits || []).forEach(t => {
            const pill = document.createElement("span");
            pill.className = "role-trait-pill";
            pill.textContent = t;
            traitsWrap.appendChild(pill);
          });

          card.appendChild(selectedTag);
          card.appendChild(titleEl);
          card.appendChild(metaRow);
          card.appendChild(bodyEl);
          card.appendChild(whyLabel);
          card.appendChild(traitsWrap);

          card.addEventListener("click", () => {
            selectedRoleTitle = role.title;
            localStorage.setItem("novaSelectedRole", selectedRoleTitle);

            document
              .querySelectorAll(".role-card")
              .forEach(el => el.classList.remove("selected"));
            card.classList.add("selected");

            const roleId = makeIdFromText(role.title, "role");
            selectedRoleObject = {
              id: roleId,
              title: role.title,
              socCode: "",
              salaryRange: role.salary,
              outlook: role.outlook,
              summary: role.blurb
            };
          });

          rolesGrid.appendChild(card);
        });
      }

      renderRoles();

      continueBtn.addEventListener("click", () => {
        if (!selectedRoleObject || !selectedRoleObject.title) {
          const proceed = confirm(
            "You haven’t selected a role yet. Do you still want to continue?"
          );
          if (!proceed) return;
        }

        const updated = loadNovaProfile();

        // Make sure category is recorded in novaProfile
        const categoryId = makeIdFromText(category, "cat");
        if (!updated.categoryIds || !updated.categoryIds.length) {
          updated.categoryIds = [categoryId];
          updated.categories = [{ id: categoryId, name: category }];
        }

        if (selectedRoleObject && selectedRoleObject.title) {
          updated.roleId = selectedRoleObject.id;
          updated.role = selectedRoleObject;
        }

        saveNovaProfile(updated);
        window.location.href = "reveal.html";
      });
    });
  </script>
</body>
</html>
